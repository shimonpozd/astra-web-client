@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew:wght@400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Noto+Rashi+Hebrew:wght@100..900&display=swap');
@import './styles/claude.css';

/* Custom Hebrew font - Mugrabi Regular */
@font-face {
  font-family: 'Mugrabi';
  src: url('/fonts/mugrabi-regular-aaa.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@tailwind base;
@tailwind components;
@tailwind utilities;

@keyframes drift1 {
  from {
    transform: translate3d(0, 0, 0);
  }
  to {
    transform: translate3d(-200px, -80px, 0);
  }
}

@keyframes drift2 {
  from {
    transform: translate3d(0, 0, 0);
  }
  to {
    transform: translate3d(180px, 60px, 0);
  }
}

@keyframes drift3 {
  from {
    transform: translate3d(0, 0, 0);
  }
  to {
    transform: translate3d(-120px, 140px, 0);
  }
}


/* =============================================================================
   –¶–í–ï–¢–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê - –µ–¥–∏–Ω–∞—è —Ç—ë–ø–ª–∞—è —Ç–µ–º–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ –∏ —Ç—ë–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º–æ–≤
   ============================================================================= */

@layer base {
  :root {
    /* üìñ –¢—ë–ø–ª–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è */
    --background: 42 33% 95%;      /* #f8f5ec ‚Äî –±—É–º–∞–∂–Ω—ã–π —Ñ–æ–Ω */
    --foreground: 30 20% 20%;      /* #3b322d ‚Äî –º—è–≥–∫–∏–π —Ç—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ç–µ–∫—Å—Ç */
    --card: 42 33% 96%;            /* #faf7ee ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ —á—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ */
    --card-foreground: 30 20% 20%; /* #3b322d ‚Äî —Ç–µ–∫—Å—Ç –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
    --popover: 42 33% 95%;         /* #f8f5ec ‚Äî –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω */
    --popover-foreground: 30 20% 20%; /* #3b322d ‚Äî —Ç–µ–∫—Å—Ç –≤ –ø–æ–ø–æ–≤–µ—Ä–∞—Ö */
    --primary: 210 40% 55%;        /* #5b8bb5 ‚Äî –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–π —Å–∏–Ω–∏–π */
    --primary-foreground: 42 33% 95%; /* #f8f5ec ‚Äî —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Å–∏–Ω–µ–º */
    --secondary: 42 20% 88%;       /* #e8e2d6 ‚Äî –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –±–µ–∂–µ–≤—ã–π */
    --secondary-foreground: 30 20% 20%; /* #3b322d ‚Äî —Ç—ë–º–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –±–µ–∂–µ–≤–æ–º */
    --muted: 42 20% 92%;           /* #ede8dc ‚Äî –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–π —Ñ–æ–Ω */
    --muted-foreground: 30 10% 40%; /* #5c5248 ‚Äî –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç */
    --accent: 42 20% 88%;          /* #e8e2d6 ‚Äî –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç */
    --accent-foreground: 30 20% 20%; /* #3b322d ‚Äî —Ç–µ–∫—Å—Ç –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–µ */
    --destructive: 0 65% 55%;      /* #c55555 ‚Äî –∫—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—à–∏–±–æ–∫ */
    --destructive-foreground: 42 33% 95%; /* #f8f5ec ‚Äî —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫—Ä–∞—Å–Ω–æ–º */
    --border: 30 15% 80%;          /* #d1c7b8 ‚Äî –º—è–≥–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã */
    --input: 30 15% 80%;           /* #d1c7b8 ‚Äî –ø–æ–ª—è –≤–≤–æ–¥–∞ */
    --ring: 30 20% 30%;            /* #4d4138 ‚Äî —Ñ–æ–∫—É—Å-–∫–æ–ª—å—Ü–æ */
    --radius: 0.5rem;              /* –†–∞–¥–∏—É—Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è */

    /* Segments: theme-aware subtle borders */
    --seg-border: color-mix(in oklab, hsl(var(--foreground)) 12%, hsl(var(--background)));
    --seg-separator: color-mix(in oklab, hsl(var(--foreground)) 10%, hsl(var(--background)));
    --seg-chrome-border: color-mix(in oklab, hsl(var(--foreground)) 14%, hsl(var(--background)));
  }

  .dark {
    /* üåô –¢—ë–ø–ª–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è */
 --background: 28 16% 15%;          /* #1F1A17 ‚Äì –≥–ª—É–±–æ–∫–∏–π –∫–æ—Ñ–µ */
    --foreground: 42 28% 90%;          /* #ECE6DA ‚Äì –∫—Ä–µ–º–æ–≤—ã–π —Ç–µ–∫—Å—Ç */

    --card: 28 14% 14%;
    --card-foreground: var(--foreground);
    --popover: 28 16% 12%;
    --popover-foreground: var(--foreground);

    --primary: 42 40% 60%;             /* #D4B259 ‚Äì –∑–æ–ª–æ—Ç–æ —Å–≤–µ—Ç–ª–µ–µ –Ω–∞ —Ç—ë–º–Ω–æ–º */
    --primary-foreground: 28 16% 12%;

    --secondary: 28 12% 22%;
    --secondary-foreground: var(--foreground);

    --muted: 28 10% 20%;
    --muted-foreground: 42 18% 72%;

    --accent: 42 38% 58%;              /* #CDAF57 ‚Äì —Ç—ë–ø–ª—ã–π –∑–æ–ª–æ—Ç–æ–π –∞–∫—Ü–µ–Ω—Ç */
    --accent-foreground: 28 16% 12%;

    --destructive: 3 60% 62%;
    --destructive-foreground: var(--foreground);

    --border: 28 12% 26%;
    --input: var(--border);
    --ring: 42 32% 86%;

    /* Bookshelf theme variables */
    --bg: 28 16% 15%;                  /* #1F1A17 ‚Äì –≥–ª—É–±–æ–∫–∏–π –∫–æ—Ñ–µ */
    --panel: 28 14% 14%;               /* #1b1916 ‚Äì –∫–∞—Ä—Ç–æ—á–∫–∏ */
    --text: 42 28% 90%;                /* #e9e3d7 ‚Äì –∫—Ä–µ–º–æ–≤—ã–π —Ç–µ–∫—Å—Ç */
    --muted: 42 18% 72%;               /* #b7ad98 ‚Äì –ø–æ–¥–ø–∏—Å–∏ */

    /* Segments: tuned for dark mode slightly higher contrast */
    --seg-border: color-mix(in oklab, hsl(var(--foreground)) 18%, hsl(var(--background)));
    --seg-separator: color-mix(in oklab, hsl(var(--foreground)) 14%, hsl(var(--background)));
    --seg-chrome-border: color-mix(in oklab, hsl(var(--foreground)) 20%, hsl(var(--background)));
  }

  /* –ë–∞–∑–æ–≤—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ (—Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ) */
  * {
    @apply border-border;
  }

  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  * {
    margin: 0;
  }

  html,
  body {
    height: 100%;
  }

  body {
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
  }

  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
  }

  /* React Flow layering */
  .react-flow__edges {
    z-index: 5;
  }
  .react-flow__nodes {
    z-index: 10;
  }
  .react-flow__handle {
    pointer-events: auto !important;
    cursor: crosshair !important;
  }
  .react-flow__connection-line {
    pointer-events: none;
  }

  input,
  button,
  textarea,
  select {
    font: inherit;
  }

  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    overflow-wrap: break-word;
  }

  #root,
  #__next {
    isolation: isolate;
    height: 100%;
  }

  /* Focus styles */
  *:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
  }

  /* Scrollbar styles - –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: hsl(var(--border));
    border-radius: 3px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--muted-foreground));
  }
}

/* =============================================================================
   –°–ò–°–¢–ï–ú–ê –î–û–ö–£–ú–ï–ù–¢–û–í (.doc) - —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   –í—Å–µ —Å—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–¥–µ—Å—å –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
   ============================================================================= */

@layer components {
  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –í–°–ï–ì–û doc.v1 */
  .doc {
    @apply mx-auto max-w-[85ch] antialiased;
    font-size: 16px;
    line-height: 1.75;
    color: var(--doc-fg);
  }

  /* 
   * –¶–í–ï–¢–û–í–ê–Ø –°–•–ï–ú–ê –î–û–ö–£–ú–ï–ù–¢–û–í
   * –í—Å–µ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º—ã –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
   * –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–¥–æ–±—Ä–∞–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
   */
  :root {
    --doc-fg: var(--foreground);                              /* –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
    --doc-dim: color-mix(in oklab, var(--doc-fg) 75%, black); /* –ü—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç */
    --doc-accent: #b8d3ea;                                    /* –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç (–º—è–≥–∫–∏–π —Å–∏–Ω–∏–π) */
    --doc-muted: color-mix(in oklab, var(--doc-fg) 55%, black); /* –û—á–µ–Ω—å –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π */
    --doc-border: color-mix(in oklab, var(--doc-fg) 14%, black); /* –ì—Ä–∞–Ω–∏—Ü—ã */
    --doc-code-bg: color-mix(in oklab, var(--doc-fg) 5.5%, black); /* –§–æ–Ω –∫–æ–¥–∞ */
    --doc-quote-bg: color-mix(in oklab, var(--doc-fg) 3.2%, black); /* –§–æ–Ω —Ü–∏—Ç–∞—Ç */
    --doc-hr: color-mix(in oklab, var(--doc-fg) 9%, black);   /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    --doc-link: #86b3cf;                                      /* –°—Å—ã–ª–∫–∏ */
    --doc-link-hover: #a9c8db;                                /* –°—Å—ã–ª–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  }

  /* –ë–∞–∑–æ–≤—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∏—Ç–º */
  .doc p,
  .doc ul,
  .doc ol,
  .doc blockquote,
  .doc pre,
  .doc table,
  .doc hr {
    @apply mb-4;
  }

  /* –ê–±–∑–∞—Ü—ã —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ */
  .doc p {
    @apply selection:bg-white/20;
    text-wrap: pretty;
    hyphens: auto;
    word-break: normal;
  }

  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ */
  .doc h1,
  .doc h2,
  .doc h3,
  .doc h4,
  .doc h5,
  .doc h6 {
    text-wrap: balance;
    font-weight: 600;
    color: var(--doc-fg);
    margin: 1.5rem 0 0.75rem 0;
  }
  
  .doc h1 { font-size: 1.875rem; line-height: 1.2; }
  .doc h2 { font-size: 1.5rem; line-height: 1.3; }
  .doc h3 { font-size: 1.25rem; line-height: 1.4; }
  .doc h4 { font-size: 1.125rem; line-height: 1.4; }
  .doc h5 { font-size: 1rem; line-height: 1.5; }
  .doc h6 { font-size: 0.875rem; line-height: 1.5; }

  /* –°—Å—ã–ª–∫–∏ */
  .doc a {
    color: var(--doc-link);
    text-decoration: none;
    border-bottom: 1px dashed color-mix(in oklab, var(--doc-link) 50%, transparent);
  }
  .doc a:hover {
    color: var(--doc-link-hover);
    border-bottom-style: solid;
  }
  .doc a:focus-visible {
    outline: 2px solid var(--doc-link);
    outline-offset: 2px;
  }

  /* –ñ–∏—Ä–Ω—ã–π/–∫—É—Ä—Å–∏–≤ */
  .doc strong { @apply font-semibold; }
  .doc em { @apply italic; }

  /* –ò–Ω–ª–∞–π–Ω –∫–æ–¥ —Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–æ–Ω–æ–º */
  .doc code {
    @apply text-[0.95em] px-1 py-0.5 rounded;
    background: var(--doc-code-bg);
  }

  /* –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–¥ —Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–æ–Ω–æ–º */
  .doc pre {
    @apply rounded-xl p-4 overflow-auto;
    border: 1px solid var(--doc-border);
    background: var(--doc-code-bg);
  }
  .doc pre code { @apply p-0 bg-transparent; }

  /* –¶–∏—Ç–∞—Ç—ã */
  .doc blockquote {
    /* –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞: —Ç–æ–Ω–∫–∞—è –ª–µ–≤–∞—è –ª–∏–Ω–∏—è + –æ—á–µ–Ω—å –ª—ë–≥–∫–∏–π —Ñ–æ–Ω */
    border-left: 2px solid var(--doc-border);
    background: color-mix(in oklab, var(--doc-fg) 2.2%, transparent); /* –±—ã–ª–æ –∑–∞–º–µ—Ç–Ω–æ —Ç–µ–º–Ω–µ–µ */
    padding: 0.5rem 1rem 0.5rem 1rem;  /* –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
    margin: 0 0 1rem 0;
    border-radius: 0.5rem;             /* –≤–º–µ—Å—Ç–æ –±–æ–ª—å—à–æ–π ¬´—Ç–∞–±–ª–µ—Ç–∫–∏¬ª */
    color: var(--doc-dim);
  }

  /* —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –≤–Ω—É—Ç—Ä–∏ —Ü–∏—Ç–∞—Ç—ã */
  .doc blockquote > :first-child { margin-top: 0; }
  .doc blockquote > :last-child  { margin-bottom: 0; }

  /* –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã/—Å–ø–∏—Å–∫–∏ –Ω–µ —Ä–∞–∑–¥—É–≤–∞—é—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–∏—Ç–º */
  .doc li > blockquote { margin: 0.5rem 0; }

  /* –°–ø–∏—Å–∫–∏ */
  .doc ul { @apply list-disc ms-6; }
  .doc ol { @apply list-decimal ms-6; }
  .doc li { @apply mb-1; }
  .doc li > ul, .doc li > ol { @apply mt-1 mb-0; }

  /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
  .doc hr {
    @apply my-6;
    border: none;
    border-top: 1px solid var(--doc-hr);
  }

  /* –¢–∞–±–ª–∏—Ü—ã */
  .doc table { @apply w-full border-collapse text-[15px]; }
  .doc th, .doc td {
    @apply border border-[var(--doc-border)] px-3 py-2;
  }
  .doc th { @apply font-medium; }

  /* –¢–µ—Ä–º–∏–Ω—ã - —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
  .doc .term {
    @apply mb-4 rounded-xl border;
    padding: 1rem 1.25rem;
    background: color-mix(in oklab, var(--doc-accent) 8%, transparent);
    border-color: color-mix(in oklab, var(--doc-accent) 20%, transparent);
    position: relative;
    transition: all 0.2s ease;
  }
  
  .doc .term:hover {
    background: color-mix(in oklab, var(--doc-accent) 12%, transparent);
    border-color: color-mix(in oklab, var(--doc-accent) 30%, transparent);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--doc-accent) 15%, transparent);
  }
  
  .doc .term::before {
    content: "üìñ";
    position: absolute;
    top: 1rem;
    right: 1.25rem;
    font-size: 1rem;
    opacity: 0.6;
  }
  
  .doc .term .term-title {
    @apply font-semibold text-base;
    color: var(--doc-fg);
    margin: 0 0 0.5rem 0;
    padding-right: 2rem; /* –ú–µ—Å—Ç–æ –¥–ª—è –∏–∫–æ–Ω–∫–∏ */
    line-height: 1.4;
  }
  
  .doc .term .term-definition,
  .doc .term p {
    color: var(--doc-dim);
    font-size: 0.9rem;
    line-height: 1.6;
    margin: 0;
  }
  
  .doc .term p:last-child { margin-bottom: 0; }

  /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  .doc figure { @apply my-4; }
  .doc img { @apply rounded-xl border border-[var(--doc-border)] mx-auto; }
  .doc figcaption { @apply text-sm text-[var(--doc-muted)] mt-2 text-center; }

  /* RTL –∏ –∏–≤—Ä–∏—Ç */
  .doc[dir="rtl"],
  .doc :where([dir="rtl"], [lang="he"], [lang="he-IL"], [lang="ar"]) {
    direction: rtl;
  }

  .doc :where([lang="he"], [lang="he-IL"]) {
    font-family: "Noto Rashi Hebrew", "Mugrabi", "Noto Sans Hebrew", 
                 "Times New Roman", serif;
    font-size: 1.1em;
    line-height: 1.6;
  }

  /* –ö–ª–∞–≤–∏—à–∏ */
  .doc kbd {
    @apply px-2 py-1 text-xs font-mono rounded;
    background: var(--doc-code-bg);
    border: 1px solid var(--doc-border);
    color: var(--doc-fg);
  }
}

/* =============================================================================
   –ü–ê–ù–ï–õ–ò - –µ–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
   ============================================================================= */

@layer components {
  /* 
   * –°–ò–°–¢–ï–ú–ê –ü–ê–ù–ï–õ–ï–ô - –µ–¥–∏–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∏ –æ—Ç—Å—Ç—É–ø—ã
   */
  
  /* –í–Ω–µ—à–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ - –µ–¥–∏–Ω—ã–π —Ü–≤–µ—Ç (—Å–∞–π–¥–±–∞—Ä—ã, —Ç–æ–ø–±–∞—Ä, bookshelf) */
  .panel-outer {
    @apply bg-card/60 backdrop-blur-sm border-border/50;
  }
  
  /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ - —Å–≤–µ—Ç–ª–µ–µ (viewport, composer, workbench) */
  .panel-inner {
    @apply bg-background/95;
  }
  
  /* –ö–∞—Ä—Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ –ø–∞–Ω–µ–ª–µ–π */
  .panel-card {
    @apply bg-card border-border/40;
  }

  /*
   * –°–ò–°–¢–ï–ú–ê –í–´–î–ï–õ–ï–ù–ò–Ø - –µ–¥–∏–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ–∫—É—Å–∞ –∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
   */
  
  /* –û—Å–Ω–æ–≤–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–µ–π */
  .panel-selected {
    @apply ring-2 ring-primary ring-offset-2 ring-offset-background;
  }
  
  /* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (discussion focus) */
  .panel-active {
    @apply ring-2 ring-primary/60;
  }
  
  /* Hover —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
  .panel-hover {
    @apply ring-1 ring-border hover:ring-primary/30;
  }

  /* FocusReader - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å –≤—ã–¥–µ–ª–µ–Ω–∏—è, —á—Ç–æ –∏ —É workbench */
  .focus-reader-selected {
    @apply border border-border/60 ring-2 ring-primary ring-offset-2 ring-offset-background;
    box-shadow: none !important;
  }
  
  .focus-reader-active {
    @apply border border-border/60;
    box-shadow: none !important;
  }

  /*
   * –°–ò–°–¢–ï–ú–ê –†–ê–°–°–¢–û–Ø–ù–ò–ô - –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
   */
  
  /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞–¥–¥–∏–Ω–≥–∏ –¥–ª—è –ø–∞–Ω–µ–ª–µ–π */
  .panel-padding {
    @apply px-4 py-3;  /* 16px –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ, 12px –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  }
  
  .panel-padding-sm {
    @apply px-3 py-2;  /* 12px –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ, 8px –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  }
  
  .panel-padding-lg {
    @apply px-6 py-4;  /* 24px –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ, 16px –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  }

  /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ gap –¥–ª—è flex/grid */
  .gap-standard {
    @apply gap-3;     /* 12px - –æ—Å–Ω–æ–≤–Ω–æ–π gap */
  }
  
  .gap-compact {
    @apply gap-2;     /* 8px - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π gap */
  }
  
  .gap-spacious {
    @apply gap-4;     /* 16px - –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã–π gap */
  }

  /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
  .space-standard {
    @apply space-y-4; /* 16px –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
  }
  
  .space-compact {
    @apply space-y-2; /* 8px –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
  }
  
  .space-messages {
    @apply space-y-6; /* 24px –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ */
  }

  /* –£–±–∏—Ä–∞–µ–º –∫–æ–ª—å—Ü–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è —É textarea –≤ composer */
  .composer-textarea {
    @apply focus:ring-0 focus-visible:ring-0 focus:outline-none focus-visible:outline-none;
    box-shadow: none !important;
    outline: none !important;
  }
  
  .composer-textarea:focus,
  .composer-textarea:focus-visible {
    box-shadow: none !important;
    outline: none !important;
    border: none !important;
  }
}

/* =============================================================================
   –£–¢–ò–õ–ò–¢–´ - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è —à—Ä–∏—Ñ—Ç–æ–≤ –∏ UI
   ============================================================================= */

@layer utilities {
  /* Focusreader controls: unified accent and sizes */
  :root { --focus-accent: #c2a970; }

  .fr-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 28px;
    width: 28px;
    border: 1px solid var(--focus-accent);
    border-radius: 9999px;
    color: var(--focus-accent);
    background: color-mix(in oklab, var(--focus-accent) 0%, hsl(var(--background)));
    transition: background .15s ease, color .15s ease, border-color .15s ease;
  }
  .fr-btn:hover { background: color-mix(in oklab, var(--focus-accent) 12%, hsl(var(--background))); }
  .fr-btn.is-active {
    background: color-mix(in oklab, var(--focus-accent) 18%, hsl(var(--background)));
    box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--focus-accent) 36%, hsl(var(--background)));
  }

  .fr-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 28px;
    min-width: 28px;
    padding: 0 8px;
    border: 1px solid var(--focus-accent);
    border-radius: 9999px;
    background: color-mix(in oklab, var(--focus-accent) 12%, hsl(var(--background)));
    color: var(--focus-accent);
    font-size: 11px;
    line-height: 1;
  }

  .fr-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    height: 28px;
    padding: 0 10px;
    border: 1px solid var(--focus-accent);
    border-radius: 9999px;
    background: color-mix(in oklab, var(--focus-accent) 12%, hsl(var(--background)));
    color: var(--focus-accent);
    font-size: 12px;
    line-height: 1;
    transition: background .15s ease, color .15s ease, border-color .15s ease;
  }
  .fr-chip:hover { background: color-mix(in oklab, var(--focus-accent) 16%, hsl(var(--background))); }
  .fr-chip.is-active {
    background: color-mix(in oklab, var(--focus-accent) 22%, hsl(var(--background)));
    box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--focus-accent) 36%, hsl(var(--background)));
  }
  /* –°—É–∂–µ–Ω–Ω—ã–π —Ñ–æ—Ä—Å-—Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç (–Ω–µ –ª–æ–º–∞–µ—Ç –∏–≤—Ä–∏—Ç) */
  .force-system-font {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  }
  
  /* –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º, –Ω–µ –∫–æ –≤—Å–µ–º –ø–æ—Ç–æ–º–∫–∞–º */
  .force-system-font :where(p, li, small, em, strong, code) {
    font-family: inherit !important;
  }

  /* –•–µ–ª–ø–µ—Ä—ã –¥–ª—è –∏–≤—Ä–∏—Ç–∞ */
  .hebrew-text {
    font-family: "Noto Rashi Hebrew", "Mugrabi", "Noto Sans Hebrew", serif;
    direction: rtl;
  }

  /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }

  /* FocusReader - —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è/–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å –∑–æ–ª–æ—Ç—ã–º –æ—Ç—Ç–µ–Ω–∫–æ–º */
  /* .focusreader .seg:hover { 
    background: rgba(194, 169, 112, 0.08) !important; 
  }
  .focusreader .seg:active { 
    background: rgba(194, 169, 112, 0.12) !important; 
  } */

  /* –ú–∏–∫—Ä–æ-—Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∏–≤—Ä–∏—Ç–∞ */
  .focusreader .hebrew {
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
    font-variant-ligatures: common-ligatures;
    font-feature-settings: "ccmp" 1, "kern" 1;
  }

  /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–µ–Ω–∏ –≤ FocusReader */
  .focusreader * {
    text-shadow: none !important;
    box-shadow: none !important;
    filter: none !important;
  }

  .focusreader .seg {
    text-shadow: none !important;
    box-shadow: none !important;
    filter: none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º ring —ç—Ñ—Ñ–µ–∫—Ç—ã */
  .focusreader .seg:focus,
  .focusreader .seg:focus-visible {
    outline: none !important;
    box-shadow: none !important;
    ring: none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º —Ç–µ–Ω–∏ –æ—Ç sticky —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
  .focusreader .sticky {
    box-shadow: none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º —Ç–µ–Ω–∏ –æ—Ç —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ FocusReader */
  .focusreader {
    box-shadow: none !important;
    text-shadow: none !important;
    filter: none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º –í–°–ï –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ç–µ–Ω–∏ –≤ FocusReader, –∫—Ä–æ–º–µ ring —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
  .focusreader {
    box-shadow: none !important;
    text-shadow: none !important;
    filter: none !important;
    drop-shadow: none !important;
  }

  .focusreader .seg,
  .focusreader .seg *,
  .focusreader .seg *::before,
  .focusreader .seg *::after {
    box-shadow: none !important;
    text-shadow: none !important;
    filter: none !important;
    drop-shadow: none !important;
  }

  /* –†–∞–∑—Ä–µ—à–∞–µ–º ring —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è */
  .focus-reader-selected {
    box-shadow: none !important;
    text-shadow: none !important;
    filter: none !important;
    drop-shadow: none !important;
  }

  /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º ring —ç—Ñ—Ñ–µ–∫—Ç—ã */
  .focus-reader-selected {
    --tw-ring-width: 2px !important;
    --tw-ring-color: rgb(59 130 246 / 0.5) !important;
    --tw-ring-offset-width: 2px !important;
    --tw-ring-offset-color: hsl(var(--background)) !important;
  }

  /* Bookshelf helpers: rely on current theme vars; do NOT override base vars */

  /* Bookshelf expandable preview */
  .bookshelf-preview {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.25s ease;
  }
  .bookshelf-preview.expanded {
    max-height: 8rem;
  }

  /* EN badge styling */
  .bookshelf-en-badge {
    font-size: 10px;
    border: 1px solid var(--accent, #c2a970);
    padding: 0 6px;
    border-radius: 999px;
    opacity: 0.95;
    background: color-mix(in oklab, var(--accent, #c2a970) 12%, transparent);
    color: var(--accent, #c2a970);
  }

  /* Category button bar */
  .bookshelf-catbtn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.35rem 0.6rem;
    border: 1px solid hsl(var(--border) / 0.28);
    border-radius: 999px;
    font-size: 12px;
    line-height: 1;
    color: hsl(var(--foreground) / 0.92);
    background: hsl(var(--panel));
    white-space: nowrap;
    max-width: 14rem;
  }
  .bookshelf-catbtn.is-active {
    color: hsl(var(--foreground));
    box-shadow: inset 0 0 0 1px hsl(var(--border) / 0.16);
  }
  .bookshelf-catbtn:hover {
    border-color: hsl(var(--border) / 0.36);
    background: color-mix(in oklab, var(--accent, #c2a970) 10%, transparent);
  }
  .bookshelf-catcount {
    font-size: 10px;
    padding: 0 0.4rem;
    border: 1px solid hsl(var(--border) / 0.22);
    border-radius: 999px;
    opacity: 0.9;
  }

  /* Active tab styling for CategoryTabs */
  .tab-active {
    position: relative;
    background: color-mix(in oklab, var(--accent) 14%, transparent);
  }
  .tab-active::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: -2px;
    height: 2px;
    background: var(--accent);
  }

}

.soft-divider { border-top: 1px solid hsl(var(--border)/.22); margin: 0.5rem 0;}
.bookshelf-catbtn { border-color: hsl(var(--border)/.22); }
.bookshelf-catbtn:hover { border-color: hsl(var(--border)/.36); background: color-mix(in oklab, var(--accent) 8%, transparent); }
.bookshelf-catbtn.is-active { box-shadow: inset 0 0 0 1px hsl(var(--border)/.16); background: color-mix(in oklab, var(--accent) 14%, transparent); }
.bookshelf-lang-badge{
  font-size:10px;
  padding:0 .4rem;
  border:1px solid hsl(var(--border) / .22);
  border-radius:999px;
  background: color-mix(in oklab, var(--accent) 12%, transparent);
  color: hsl(var(--foreground) / .92);
  opacity:.95;
}

/* React Flow debug: force edges visible */
.react-flow__edge-path,
.react-flow__connection-path {
  stroke: hsl(var(--primary)) !important;
  stroke-width: 2px !important;
}

.react-flow__edge {
  pointer-events: visibleStroke;
}

/* FocusReader entity highlights */
.hover-target {
  cursor: pointer;
  transition: background-color 0.15s ease, box-shadow 0.15s ease;
  padding: 0 2px;
  border-radius: 4px;
}
.hover-target:hover {
  box-shadow: inset 0 0 0 1px hsl(var(--border) / 0.55);
}
.highlight-sage {
  background: color-mix(in srgb, #f7d674 26%, transparent);
  box-shadow: inset 0 0 0 1px hsl(var(--border) / 0.35);
  color: inherit;
}
.highlight-sage-zugot {
  background: color-mix(in srgb, #f7d674 32%, transparent);
}
.highlight-sage-tannaim {
  background: color-mix(in srgb, #8ec5ff 24%, transparent);
}
.highlight-sage-amoraim {
  background: color-mix(in srgb, #77e2c1 22%, transparent);
}
.highlight-sage-achronim {
  background: color-mix(in srgb, #ff9aa2 22%, transparent);
}
.highlight-concept {
  background: color-mix(in srgb, #c8b8ff 24%, transparent);
  box-shadow: inset 0 0 0 1px hsl(var(--border) / 0.35);
  color: inherit;
}
